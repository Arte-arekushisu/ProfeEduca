import streamlit as st
from docx import Document
from io import BytesIO
import datetime

def crear_texto_reflexivo(datos):
    doc = Document()
    
    # Encabezado Institucional
    doc.add_heading('REGISTRO DEL PROCESO DE APRENDIZAJE (TEXTO REFLEXIVO)', 0)
    
    # Datos de Identificaci贸n
    table = doc.add_table(rows=2, cols=2)
    table.cell(0,0).text = f"Educador Comunitario: {datos['ec']}"
    table.cell(0,1).text = f"Nombre del Aprendiz: {datos['alumno']}"
    table.cell(1,0).text = f"Comunidad: {datos['comunidad']}"
    table.cell(1,1).text = f"Fecha: {datos['fecha']}"

    doc.add_heading('Relato del Proceso de Aprendizaje', level=1)
    
    # Aqu铆 la IA redacta de forma extensiva basada en las notas
    cuerpo = f"""
    Durante la sesi贸n de tutor铆a, iniciamos el di谩logo a partir del inter茅s del aprendiz por {datos['interes']}. 
    Se plante贸 el desaf铆o inicial centrado en {datos['desafio']}, lo cual gener贸 una reacci贸n de {datos['reaccion_inicial']} en el alumno.
    
    A medida que avanzamos, el aprendiz enfrent贸 dificultades en {datos['dificultades']}. En este punto, como educador, 
    intervine mediante la estrategia de {datos['estrategia_ec']}, permitiendo que el alumno descubriera por s铆 mismo el error. 
    Fue gratificante observar c贸mo, a trav茅s del di谩logo, logr贸 llegar a la conclusi贸n de que {datos['logro']}.
    
    El proceso concluy贸 con una reflexi贸n sobre lo aprendido, donde el aprendiz manifest贸 sentirse {datos['sentimiento_alumno']} 
    y mostr贸 disposici贸n para tutorar este tema a otros compa帽eros en las pr贸ximas jornadas.
    """
    
    p = doc.add_paragraph(cuerpo)
    
    # Firma
    doc.add_paragraph("\n\n__________________________\nFirma del Educador")

    buffer = BytesIO()
    doc.save(buffer)
    buffer.seek(0)
    return buffer

# --- INTERFAZ DEL GENERADOR ---
st.title("锔 Generador de Textos Reflexivos")
st.write("Convierte tus notas r谩pidas en un relato pedag贸gico de una cuartilla.")

with st.form("form_reflexivo"):
    col1, col2 = st.columns(2)
    with col1:
        ec = st.text_input("Nombre del Educador")
        alumno = st.text_input("Nombre del Alumno")
        fecha = st.date_input("Fecha de la sesi贸n", datetime.date.today())
    with col2:
        comunidad = st.text_input("Comunidad")
        interes = st.text_input("驴Qu茅 tema le interes贸 al ni帽o?")

    st.subheader(" Notas del Proceso (Anotaciones r谩pidas)")
    desafio = st.text_area("驴Cu谩l fue el desaf铆o que le pusiste?")
    reaccion = st.text_input("驴C贸mo reaccion贸 al principio? (Ej: Dudoso, emocionado)")
    dificultad = st.text_area("驴En qu茅 se trab贸 o qu茅 le cost贸 trabajo?")
    estrategia = st.text_area("驴Qu茅 pista o pregunta le hiciste t煤 para ayudarlo?")
    logro = st.text_area("驴Qu茅 logr贸 entender al final?")
    sentimiento = st.selectbox("驴C贸mo se sinti贸 el alumno al final?", ["Motivado", "Satisfecho", "Con ganas de aprender m谩s", "Seguro"])

    enviar = st.form_submit_button("Redactar Texto Reflexivo")

if enviar:
    datos_reflexion = {
        "ec": ec, "alumno": alumno, "fecha": fecha, "comunidad": comunidad,
        "interes": interes, "desafio": desafio, "reaccion_inicial": reaccion,
        "dificultades": dificultad, "estrategia_ec": estrategia, 
        "logro": logro, "sentimiento_alumno": sentimiento
    }
    
    archivo = crear_texto_reflexivo(datos_reflexion)
    st.success("隆Texto reflexivo redactado! Tiene la extensi贸n ideal de una p谩gina.")
    st.download_button(" Descargar Texto Reflexivo (.docx)", data=archivo, file_name=f"Reflexion_{alumno}.docx")
