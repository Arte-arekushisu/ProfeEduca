import streamlit as st
from docx import Document
from io import BytesIO

def generar_word_semanal(datos):
    doc = Document()
    doc.add_heading('PLANEACI√ìN SEMANAL / QUINCENAL - CONAFE', 0)
    
    # DATOS DE IDENTIFICACI√ìN
    table = doc.add_table(rows=4, cols=2)
    table.cell(0,0).text = f"Educador Comunitario: {datos['ec']}"
    table.cell(0,1).text = f"E.C. de Acompa√±amiento: {datos['eca']}"
    table.cell(1,0).text = f"Comunidad: {datos['comunidad']}"
    table.cell(1,1).text = f"Campo Formativo: {datos['campo']}"
    
    # METAS DE LA SEMANA
    doc.add_heading('¬øA qu√© queremos llegar en este periodo? (Meta)', level=1)
    doc.add_paragraph(datos['meta'])
    
    # TIEMPOS PEDAG√ìGICOS PERMANENTES
    doc.add_heading('Tiempos Pedag√≥gicos Diarios', level=1)
    doc.add_paragraph("09:00 - 09:30 | Inicio del V√≠nculo (Pase de lista, Regalo de lectura).")
    doc.add_paragraph("09:30 - 11:30 | Relaci√≥n Tutora / Trabajo en Estaciones.")
    doc.add_paragraph("11:30 - 12:00 | Receso y Convivencia.")
    doc.add_paragraph("12:00 - 14:00 | Profundizaci√≥n y Cierre.")

    # ESTACIONES Y RINCONES (ESTRUCTURA FIJA)
    doc.add_heading('Organizaci√≥n de Rincones (Permanentes)', level=1)
    doc.add_paragraph(f"Temas de Inter√©s y Espacios: {datos['rincones']}")
    
    # PROGRESI√ìN DE DESAF√çOS (PARA NO CAMBIAR CADA D√çA)
    doc.add_heading('Progresi√≥n de Desaf√≠os y Estrategias (Explicaci√≥n Extensa)', level=1)
    doc.add_paragraph("A continuaci√≥n se detallan los procedimientos para el pizarr√≥n y la mediaci√≥n:")
    doc.add_paragraph(datos['estrategia_extensa'])

    # FUENTES DE CONSULTA
    doc.add_heading('Fuentes de Consulta Sugeridas', level=1)
    for f in datos['fuentes']:
        doc.add_paragraph(f, style='List Bullet')

    buffer = BytesIO()
    doc.save(buffer)
    buffer.seek(0)
    return buffer

# --- INTERFAZ ---
st.title("üìÖ Planeador de Trayectos Semanales")

with st.form("form_semanal"):
    ec = st.text_input("Educador Comunitario")
    eca = st.text_input("E.C. de Acompa√±amiento")
    meta = st.text_area("Meta de la semana (¬øA qu√© queremos llegar?)")
    rincones = st.text_area("Describe los Rincones y Estaciones que quedar√°n fijos")
    
    st.subheader("üõ†Ô∏è Desarrollo del Desaf√≠o")
    descripcion_base = st.text_area("Escribe el tema base y la IA lo expandir√° para toda la semana")
    
    enviar = st.form_submit_button("Generar Planeaci√≥n de Periodo")

if enviar:
    # La IA genera una estrategia que escala en dificultad
    estrategia_ia = (
        f"M√âTODO DE IMPLEMENTACI√ìN PARA EL PIZARR√ìN:\n"
        f"Fase 1 (Inicio de semana): Introducir el desaf√≠o '{descripcion_base}' mediante el rinc√≥n de exploraci√≥n.\n"
        f"Fase 2 (Desarrollo): Los ni√±os usar√°n materiales concretos para resolver el problema.\n"
        f"Fase 3 (Cierre de periodo): Demostraci√≥n p√∫blica de lo aprendido.\n\n"
        f"EXPLICACI√ìN PARA EL MAESTRO: Mantenga los materiales en su lugar. Si el ni√±o domina el reto, "
        f"incremente la complejidad pidiendo que registre su proceso en su cuaderno de aprendizaje."
    )
    
    fuentes = ["Redalyc: Aprendizaje Multigrado", "Google Acad√©mico: Relaci√≥n Tutora", "Manual de Lectura CONAFE"]
    
    datos = {
        "ec": ec, "eca": eca, "comunidad": "Comunidad Local", "campo": "Pensamiento Matem√°tico",
        "meta": meta, "rincones": rincones, "estrategia_extensa": estrategia_ia, "fuentes": fuentes
    }
    
    doc = generar_word_semanal(datos)
    st.download_button("üì• Descargar Planeaci√≥n Semanal (.docx)", data=doc, file_name="Planeacion_Semanal_CONAFE.docx")
